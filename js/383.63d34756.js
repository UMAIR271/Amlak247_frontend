"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[383],{6383:function(e,s,a){a.r(s),a.d(s,{default:function(){return O}});var t=a(9389),o=a(849),i=a(2989);const l={class:"container-fluid h-100 mt-4"},r={class:"row justify-content-center h-100"},c={class:"col-md-4 col-xl-3 chat"},n={class:"card mb-sm-3 mb-md-0 contacts_card"},d=(0,t.uE)('<div class="card-header"><div class="input-group"><input type="text" placeholder="Search..." name="" class="form-control search"><div class="input-group-prepend"><span class="input-group-text search_btn"><i class="fas fa-search"></i></span></div></div></div>',1),g={class:"card-body contacts_body"},h=["onClick"],u={class:"d-flex bd-highlight"},m={class:"img_cont"},p=["src"],_=(0,t._)("span",{class:"online_icon"},null,-1),f={class:"user_info"},v=(0,t._)("div",{class:"card-footer"},null,-1),y={class:"col-md-8 col-xl-6 chat"},D={class:"card"},b={class:"card-header msg_head"},M={class:"d-flex bd-highlight"},w={key:0,class:"img_cont"},k=["src"],I=(0,t._)("span",{class:"online_icon"},null,-1),A={class:"user_info"},x={key:0},U=(0,t._)("p",null,"1767 Messages",-1),j=(0,t._)("div",{class:"video_cam"},[(0,t._)("span",null,[(0,t._)("i",{class:"fas fa-video"})]),(0,t._)("span",null,[(0,t._)("i",{class:"fas fa-phone"})])],-1),T=(0,t.uE)('<span id="action_menu_btn"><i class="fas fa-ellipsis-v"></i></span><div class="action_menu"><ul><li><i class="fas fa-user-circle"></i> View profile</li><li><i class="fas fa-users"></i> Add to close friends</li><li><i class="fas fa-plus"></i> Add to group</li><li><i class="fas fa-ban"></i> Block</li></ul></div>',2),L={key:0,class:"card-body msg_card_body"},S={key:0,class:"d-flex justify-content-start mb-4"},z={class:"img_cont_msg"},C=["src"],P={class:"msg_cotainer"},F={key:1,class:"d-flex justify-content-end mb-4"},N={class:"msg_cotainer_send"},R={class:"card-footer"},$={class:"input-group"},B=(0,t._)("div",{class:"input-group-append"},[(0,t._)("span",{class:"input-group-text attach_btn"},[(0,t._)("i",{class:"fas fa-paperclip"})])],-1),E={class:"input-group-append"},Z=(0,t._)("i",{class:"fas fa-location-arrow"},null,-1),q=[Z];function H(e,s,a,Z,H,K){const V=(0,t.up)("ui");return(0,t.wg)(),(0,t.iD)("div",l,[(0,t._)("div",r,[(0,t._)("div",c,[(0,t._)("div",n,[d,(0,t._)("div",g,[(0,t.Wm)(V,{class:"contacts"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(H.roomListData,(e=>((0,t.wg)(),(0,t.iD)("li",{class:"chat_active",key:e.id,onClick:s=>K.getAllMeassage(e.chat_profile.sender_id,e.username,e.profile_image)},[(0,t._)("div",u,[(0,t._)("div",m,[(0,t._)("img",{src:"https://umair2701.pythonanywhere.com/"+e.profile_image,class:"rounded-circle user_img"},null,8,p),_]),(0,t._)("div",f,[(0,t._)("span",null,(0,o.zw)(e.username),1),(0,t._)("p",null,(0,o.zw)(e.chat_profile.message),1)])])],8,h)))),128))])),_:1})]),v])]),(0,t._)("div",y,[(0,t._)("div",D,[(0,t._)("div",b,[(0,t._)("div",M,[H.roomProfileImage?((0,t.wg)(),(0,t.iD)("div",w,[(0,t._)("img",{src:"https://umair2701.pythonanywhere.com/"+H.roomProfileImage,class:"rounded-circle user_img"},null,8,k),I])):(0,t.kq)("",!0),(0,t._)("div",A,[H.roomName?((0,t.wg)(),(0,t.iD)("span",x,(0,o.zw)(H.roomName),1)):(0,t.kq)("",!0),U]),j]),T]),H.active?((0,t.wg)(),(0,t.iD)("div",L,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(H.getAllMessagesDatabase,(e=>((0,t.wg)(),(0,t.iD)("div",{key:e.id},[e.receiver==H.currentUserID?((0,t.wg)(),(0,t.iD)("div",S,[(0,t._)("div",z,[(0,t._)("img",{src:"https://umair2701.pythonanywhere.com/"+H.roomProfileImage,class:"rounded-circle user_img_msg"},null,8,C)]),(0,t._)("div",P,(0,o.zw)(e.message),1)])):((0,t.wg)(),(0,t.iD)("div",F,[(0,t._)("div",N,(0,o.zw)(e.message),1)]))])))),128))])):(0,t.kq)("",!0),(0,t._)("div",R,[(0,t._)("div",$,[B,(0,t.wy)((0,t._)("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>H.message=e),class:"form-control type_msg",placeholder:"Type your message..."},null,512),[[i.nr,H.message]]),(0,t._)("div",E,[(0,t._)("span",{class:"input-group-text send_btn",onClick:s[1]||(s[1]=(...e)=>K.sendMessage&&K.sendMessage(...e))},q)])])])])])])])}a(2044);var K=a(3057),V=a.n(K),Y=a(3669),W={data(){return{client:null,currentUserID:"",recipientUserID:"",message:"",token:"",roomListData:[],getAllMessagesDatabase:[],sendMessageList:[],active:!1,roomName:"",roomProfileImage:"",dataobj:{sender_id:"",username:"",profile_image:""}}},mounted(){this.currentUserID=localStorage.getItem("user_id"),this.token=localStorage.getItem("token"),this.recipientUserID=this.$store?.state?.data?.userId,console.log(typeof this.recipientUserID),console.log("recipientUserID",this.recipientUserID),console.log("currentUserID",this.currentUserID);const e=V().createInstance("21c61a1aa5d44cc09fda7e95b43561a2");e.login({token:null,uid:this.currentUserID}).then((()=>{console.log("Logged in to Agora RTM successfully")})).catch((e=>{console.log("Failed to log in to Agora RTM",e)})),this.getAllMessagesDatabase=[],e.on("MessageFromPeer",((e,s)=>{console.log(s,"peerId"),this.active=!0,this.getAllMessagesDatabase.push({receiver:this.currentUserID,message:e.text}),console.log(`Received message from ${s}: ${e.text}`)})),this.recivedMessageToServer(),this.client=e},methods:{sendMessage(){const e={text:this.message};this.client.sendMessageToPeer(e,this.recipientUserID).then((()=>{console.log("Message sent successfully"),console.log(e.text),this.sendMessageList.push(e.text),this.sendToServer(e),this.getAllMeassage(this.dataobj.sender_id,this.dataobj.username,this.dataobj.profile_image)})).catch((e=>{console.log("Failed to send message",e)}))},sendToServer(e){const s={headers:{Accept:"application/json","Content-Type":"multipart/form-data",Authorization:"Bearer "+this.token}};Y.Z.post("https://umair2701.pythonanywhere.com/chat/api/send_messages/",{message:e.text,receiver:this.recipientUserID,message_type:"text"},s).then((()=>{console.log("Message sent to server successfully")})).catch((e=>{console.log("Failed to send message to server",e)}))},async recivedMessageToServer(){const e={headers:{Accept:"application/json","Content-Type":"multipart/form-data",Authorization:"Bearer "+this.token}};try{const s=await Y.Z.get("https://umair2701.pythonanywhere.com/chat/api/get_chat_inbox/",e);console.log("get_chat_inbox",s.data),s.data.forEach((e=>{this.roomListData.push(e),this.roomProfileImage=e.profile_image})),this.getAllMeassage(this.roomListData[0]?.chat_profile?.sender_id,this.roomListData[0]?.username,this.roomListData[0]?.profile_image),console.log("Message sent to server successfully")}catch(s){console.log("Failed to send message to server",s)}},async getAllMeassage(e,s,a){this.profile_image="",console.log("getAllMeassage",String(e)),this.dataobj.sender_id=e,this.recipientUserID=String(e),this.dataobj.username=s,this.dataobj.profile_image=a,this.roomName=this.$store?.state?.data?.userName,this.roomProfileImage=a;const t={headers:{Accept:"application/json","Content-Type":"multipart/form-data",Authorization:"Bearer "+this.token}};try{const s=await Y.Z.get(`https://umair2701.pythonanywhere.com/chat/api/get_chat/${e}/`,t);console.log(s.data),this.getAllMessagesDatabase=[],s.data.forEach((e=>{this.getAllMessagesDatabase.push(e)})),this.active=!0,this.getAllMessagesDatabase=this.getAllMessagesDatabase.reverse(),console.log("lksdk"),console.log("Message sent to server successfully")}catch(o){console.log("Failed to send message to server",o)}}},beforeUnmount(){this.client.logout().then((()=>{console.log("Logged out of Agora RTM successfully")})).catch((e=>{console.log("Failed to log out of Agora RTM",e)}))}},G=a(1935);const J=(0,G.Z)(W,[["render",H]]);var O=J}}]);
//# sourceMappingURL=383.63d34756.js.map